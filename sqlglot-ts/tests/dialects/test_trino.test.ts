// @generated by codegen_tests.py -- DO NOT EDIT
import { describe, it, expect } from "vitest";
import { transpile } from "../../src/index.js";

const DIALECT = "trino";

function validateIdentity(sql: string, writeSql?: string): void {
  const result = transpile(sql, { readDialect: DIALECT, writeDialect: DIALECT })[0];
  expect(result).toBe(writeSql ?? sql);
}

describe("Trino: trino", () => {
  it.todo("REFRESH MATERIALIZED VIEW mynamespace.test_view (command not supported)");
  it("JSON_QUERY(m.properties, 'lax $.area' OMIT QUOTES NULL ON ERROR)", () => {
    validateIdentity("JSON_QUERY(m.properties, 'lax $.area' OMIT QUOTES NULL ON ERROR)");
  });
  it("JSON_EXTRACT(content, json_path)", () => {
    validateIdentity("JSON_EXTRACT(content, json_path)");
  });
  it("JSON_QUERY(content, 'lax $.HY.*')", () => {
    validateIdentity("JSON_QUERY(content, 'lax $.HY.*')");
  });
  it("JSON_QUERY(content, 'strict $.HY.*' WITH WRAPPER)", () => {
    validateIdentity("JSON_QUERY(content, 'strict $.HY.*' WITH WRAPPER)");
  });
  it("JSON_QUERY(content, 'strict $.HY.*' WITH ARRAY WRAPPER)", () => {
    validateIdentity("JSON_QUERY(content, 'strict $.HY.*' WITH ARRAY WRAPPER)");
  });
  it("JSON_QUERY(content, 'strict $.HY.*' WITH UNCONDITIONAL WRAPPER)", () => {
    validateIdentity("JSON_QUERY(content, 'strict $.HY.*' WITH UNCONDITIONAL WRAPPER)");
  });
  it("JSON_QUERY(content, 'strict $.HY.*' WITHOUT CONDITIONAL WRAPPER)", () => {
    validateIdentity("JSON_QUERY(content, 'strict $.HY.*' WITHOUT CONDITIONAL WRAPPER)");
  });
  it("JSON_QUERY(description, 'strict $.comment' KEEP QUOTES)", () => {
    validateIdentity("JSON_QUERY(description, 'strict $.comment' KEEP QUOTES)");
  });
  it("JSON_QUERY(description, 'strict $.comment' OMIT QUOTES ON SCALAR STRING)", () => {
    validateIdentity("JSON_QUERY(description, 'strict $.comment' OMIT QUOTES ON SCALAR STRING)");
  });
  it("JSON_QUERY(content, 'strict $.HY.*' WITH UNCONDITIONAL WRAPPER KEEP QUOTES)", () => {
    validateIdentity("JSON_QUERY(content, 'strict $.HY.*' WITH UNCONDITIONAL WRAPPER KEEP QUOTES)");
  });
  it.todo("SELECT TIMESTAMP '2012-10-31 01:00 -2' (unsupported syntax)");
  it.todo("SELECT TIMESTAMP '2012-10-31 01:00 +2' (unsupported syntax)");
  it.todo("SELECT TIMESTAMP '2012-10-31 01:00:00 +02:00' (unsupported syntax)");
  it("trino -> duckdb: SELECT FORMAT('%s', 123)", () => {
    const result = transpile("SELECT FORMAT('%s', 123)", { readDialect: DIALECT, writeDialect: "duckdb" })[0];
    expect(result).toBe("SELECT FORMAT('{}', 123)");
  });
  it("trino -> snowflake: SELECT FORMAT('%s', 123)", () => {
    const result = transpile("SELECT FORMAT('%s', 123)", { readDialect: DIALECT, writeDialect: "snowflake" })[0];
    expect(result).toBe("SELECT TO_CHAR(123)");
  });
  it("trino -> trino: SELECT FORMAT('%s', 123)", () => {
    const result = transpile("SELECT FORMAT('%s', 123)", { readDialect: DIALECT, writeDialect: "trino" })[0];
    expect(result).toBe("SELECT FORMAT('%s', 123)");
  });
  it.todo("SELECT * FROM tbl MATCH_RECOGNIZE (PARTITION BY id ORDER BY col MEA... (unsupported clause)");
  it("SELECT VERSION()", () => {
    validateIdentity("SELECT VERSION()");
  });
});

describe("Trino: listagg", () => {
  it.todo("SELECT LISTAGG(DISTINCT col, ',') WITHIN GROUP (ORDER BY col ASC) F... (unsupported clause)");
  it.todo("SELECT LISTAGG(col, '; ' ON OVERFLOW ERROR) WITHIN GROUP (ORDER BY ... (unsupported clause)");
  it.todo("SELECT LISTAGG(col, '; ' ON OVERFLOW TRUNCATE WITH COUNT) WITHIN GR... (unsupported clause)");
  it.todo("SELECT LISTAGG(col, '; ' ON OVERFLOW TRUNCATE WITHOUT COUNT) WITHIN... (unsupported clause)");
  it.todo("SELECT LISTAGG(col, '; ' ON OVERFLOW TRUNCATE '...' WITH COUNT) WIT... (unsupported clause)");
  it.todo("SELECT LISTAGG(col, '; ' ON OVERFLOW TRUNCATE '...' WITHOUT COUNT) ... (unsupported clause)");
  it.todo("SELECT LISTAGG(col) WITHIN GROUP (ORDER BY col DESC) FROM tbl (unsupported clause)");
});

describe("Trino: trim", () => {
  it.todo("SELECT TRIM('!' FROM '!foo!') (unsupported syntax)");
  it.todo("SELECT TRIM(BOTH '$' FROM '$var$') (unsupported syntax)");
  it.todo("SELECT TRIM(TRAILING 'ER' FROM UPPER('worker')) (unsupported syntax)");
  it.todo("SELECT TRIM(LEADING FROM '  abcd') (unsupported syntax)");
  it("SELECT TRIM('!foo!', '!') -> SELECT TRIM('!' FROM '!foo!')", () => {
    validateIdentity("SELECT TRIM('!foo!', '!')", "SELECT TRIM('!' FROM '!foo!')");
  });
});

describe("Trino: ddl", () => {
  it.todo("ALTER TABLE users RENAME TO people (DDL/DML not supported)");
  it.todo("ALTER TABLE IF EXISTS users RENAME TO people (DDL/DML not supported)");
  it.todo("ALTER TABLE users ADD COLUMN zip VARCHAR (DDL/DML not supported)");
  it.todo("ALTER TABLE IF EXISTS users ADD COLUMN IF NOT EXISTS zip VARCHAR (DDL/DML not supported)");
  it.todo("ALTER TABLE users DROP COLUMN zip (DDL/DML not supported)");
  it.todo("ALTER TABLE IF EXISTS users DROP COLUMN IF EXISTS zip (DDL/DML not supported)");
  it.todo("ALTER TABLE users RENAME COLUMN id TO user_id (DDL/DML not supported)");
  it.todo("ALTER TABLE IF EXISTS users RENAME COLUMN IF EXISTS id TO user_id (DDL/DML not supported)");
  it.todo("ALTER TABLE users ALTER COLUMN id SET DATA TYPE BIGINT (DDL/DML not supported)");
  it.todo("ALTER TABLE users ALTER COLUMN id DROP NOT NULL (DDL/DML not supported)");
  it.todo("ALTER TABLE people SET AUTHORIZATION alice (check_command_warning)");
  it.todo("ALTER TABLE people SET AUTHORIZATION ROLE PUBLIC (check_command_warning)");
  it.todo("ALTER TABLE people SET PROPERTIES x = 'y' (check_command_warning)");
  it.todo("ALTER TABLE people SET PROPERTIES foo = 123, 'foo bar' = 456 (check_command_warning)");
  it.todo("ALTER TABLE people SET PROPERTIES x = DEFAULT (check_command_warning)");
  it.todo("ALTER VIEW people RENAME TO users (DDL/DML not supported)");
  it.todo("ALTER VIEW people SET AUTHORIZATION alice (check_command_warning)");
  it.todo("CREATE SCHEMA foo WITH (LOCATION='s3://bucket/foo') (DDL/DML not supported)");
  it.todo("CREATE TABLE foo.bar WITH (LOCATION='s3://bucket/foo/bar') AS SELECT 1 (DDL/DML not supported)");
  it.todo("CREATE TABLE foo (a VARCHAR, b INTEGER, c DATE) WITH (PARTITIONED_B... (DDL/DML not supported)");
  it.todo('CREATE TABLE "foo" ("a" VARCHAR, "b" INTEGER, "c" DATE) WITH (PARTI... (identify=True not supported)');
  it.todo("CREATE TABLE foo (a VARCHAR, b INTEGER, c DATE) WITH (PARTITIONING=... (DDL/DML not supported)");
  it.todo('CREATE TABLE "foo" ("a" VARCHAR, "b" INTEGER, "c" DATE) WITH (PARTI... (identify=True not supported) (2)');
});

describe("Trino: analyze", () => {
  it.todo("ANALYZE tbl (command not supported)");
  it.todo("ANALYZE tbl WITH (prop1=val1, prop2=val2) (command not supported)");
});

describe("Trino: json_value", () => {
  it("JSON_VALUE(jl.extra_attributes, 'lax $.amount_source' RETURNING VARCHAR)", () => {
    validateIdentity("JSON_VALUE(jl.extra_attributes, 'lax $.amount_source' RETURNING VARCHAR)");
  });
  it.todo("test_json_value: unresolvable SQL string");
  it.todo("test_json_value: unresolvable SQL string (2)");
  it.todo("test_json_value: unresolvable SQL string (3)");
  it.todo("test_json_value: unresolvable SQL string (4)");
  it.todo("test_json_value: unresolvable SQL string (5)");
});
